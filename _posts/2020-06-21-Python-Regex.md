---
layout: post
title:  "Регулярные выражения Python"
crawlertitle: "Регулярные выражения в Python"
summary: "RegEx Python"
date:   2022-05-07 23:09:47 +0700
categories: posts
tags: ['Дата аналитика']
#author: Felipe
---


Регулярные выражения (RegEx) — это специальная последовательность символов, которая использует шаблон поиска для поиска строки или набора строк. Он может определять наличие или отсутствие текста путем сопоставления с определенным шаблоном, а также может разбивать шаблон на один или несколько подшаблонов. Python предоставляет модуль re, который поддерживает использование регулярных выражений в Python. Его основная функция — предлагать поиск, где он принимает регулярное выражение и строку. Он либо возвращает первое совпадение, либо ничего.


# Сырые строки / raw strings

Чтобы строка стала «сырой», перед ней необходимо поставить символ r в любом регистре:

{% highlight r %}
common_string = 'C:\file.txt'
raw_string = r'C:\file.txt'
{% endhighlight %}

В такой строке отключается экранирование. Это значит, что обратный слеш считается самостоятельным символом. Основное применение сырых строк – работа с регулярными выражениями.

Можно использовать несколько префиксов сразу. Например, вот так:

{% highlight r %}
raw_f_string = rf'C:\file.txt'
f_raw_string = fr'C:\file.txt'
{% endhighlight %}

# Экранирование в регулярных выражениях

В регулярных выражениях также есть экранирование. Каждое регулярное выражение, которое используется в коде, компилируется интерпретатором, и заменяет управляющие последовательности на другие символы. Если нам нужно использовать какой-то спецсимвол как простой текст, то достаточно поставить перед ним \. Это работает со всеми спецсимволами!

# Полезные строки

Если для тестирования регулярных выражений вам понадобится английский/русский алфавит, цифры, или символы - можете воспользоваться следующей строчкой:

{% highlight r %}
<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~абвгдеёжзийклмнопрстуфхцчшщъыьэюяАБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ !"#$%&\'()*+,-./0123456789:;
{% endhighlight %}

С помощью неё можно наглядно увидеть как работает какой-либо спецсимвол или шаблон. Для тестирования примитивных выражений будет очень полезна.

# Синтаксис регулярных выражений

У регулярных выражений существует свой необычный синтаксис. Мы пройдём все темы по порядку. Начнём с текста как регулярного выражения.

# Текст как регулярное выражение

Начнём с самых лёгких регулярных выражений - текстовых. Простая строка r"Привет" может быть использована как регулярное выражение:

{% highlight r %}
r"Привет"
{% endhighlight %}

# Использование квадратных скобок

1) Если мы хотим заменить несколько символов, мы можем использовать такой синтаксис с квадратными скобками:

{% highlight r %}
r'[cr1]' #Найдёт c, r, и 1
r'[cr]at' #Найдёт слова cat и rat
r'[12]7[56]' #Найдёт 175, 176, 275, 276
{% endhighlight %}

От перестановки символов смысл не меняется:

{% highlight r %}
r'[cr1]' #Найдёт c, r, и 1
r'[rc1]' #Найдёт c, r, и 1
r'[1cr]' #Найдёт c, r, и 1
r'[1rc]' #Найдёт c, r, и 1
r'[c1r]' #Найдёт c, r, и 1
r'[r1c]' #Найдёт c, r, и 1
#Все регулярные выражения сверху выдают один и тот же результат
{% endhighlight %}

2) Если мы хотим исключить какие-либо символы, мы можем использовать скобки так:

{% highlight r %}
r'[^12]' #Найдёт всё, кроме 1 и 2
r'[^12]7' #Найдёт всё, кроме 17 и 27
{% endhighlight %}

Достаточно перед символами, которые мы хотим исключить, прописать символ ^.

3) Регулярное выражение в скобках можно сократить вот так:

{% highlight r %}
r'[0-9]' #То же самое, что и [0123456789]
r'[a-z]' #То же самое, что и [abcdefghijklmnopqrstuvwxyz]
r'[A-Z]' #То же самое, что и [ABCDEFGHIJKLMNOPQRSTUVWXYZ]
r'[а-я]' #То же самое, что и [абвгдежзийклмнопрстуфхцчшщъыьэюя]
r'[А-Я]' #То же самое, что и [АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ]
{% endhighlight %}

Можно получать неполный алфавит, или не все цифры:

{% highlight r %}
r'[4-7]' #То же самое, что и [4567]
r'[x-z]' #То же самое, что и [xyz]
r'[B-D]' #То же самое, что и [BCD]
r'[а-ж]' #То же самое, что и [абвгдеж]
r'[П-Т]' #То же самое, что и [ПРСТ]
r'[6-D]' #То же самое, что и [6789ABCD]
{% endhighlight %}

А также совмещать синтаксис:

{% highlight r %}
r'[4-7qwerty]' #То же самое, что и [qwerty4567]
r'[23x-z1]' #То же самое, что и [xyz123]
r'[B-DF]' #То же самое, что и [BCDF]
{% endhighlight %}

4) Исключение символов можно тоже сократить:

{% highlight r %}
r'[^0-9]' #То же самое, что и [^0123456789]
r'[^a-z]' #То же самое, что и [^abcdefghijklmnopqrstuvwxyz]
r'[^A-Z]' #То же самое, что и [^ABCDEFGHIJKLMNOPQRSTUVWXYZ]
r'[^а-я]' #То же самое, что и [^абвгдежзийклмнопрстуфхцчшщъыьэюя]
r'[^А-Я]' #То же самое, что и [^АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯ]
{% endhighlight %}

Можно исключать неполный алфавит, или не все цифры:

{% highlight r %}
r'[^4-7]' #То же самое, что и [^4567]
r'[^x-z]' #То же самое, что и [^xyz]
r'[^B-D]' #То же самое, что и [^BCD]
r'[^а-ж]' #То же самое, что и [^абвгдеж]
r'[^П-Т]' #То же самое, что и [^ПРСТ]
r'[^6-D]' #То же самое, что и [^6789ABCD]
{% endhighlight %}

Ну и совмещать:

{% highlight r %}
r'[^4-7qwerty]' #То же самое, что и [^qwerty4567]
r'[^23x-z1]' #То же самое, что и [^xyz123]
r'[^B-DF]' #То же самое, что и [^BCDF]
{% endhighlight %}

5) Можно использовать столько сокращений, сколько мы захотим:

{% highlight r %}
r'[a-zA-Z0-9]' #То же самое, что [abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789]
r'[^э-я1-3]' #То же самое, что и [^эюя123]
{% endhighlight %}

Обратите внимание, что шаблон [а-яА-Я] не захватывает буквы ё и Ё.

# Шаблоны

В регулярных выражения можно использовать специальные шаблоны, которые могут соответствовать как одному, так и нескольким символам.

<table>
	<tbody>
		<tr>
			<th>\n</th>
			<th>Новая строка</th>
		</tr>
		<tr>
			<td>.</td>
			<td>Любой символ, кроме символа новой строки. Если flag=re.DOTALL - любой символ.</td>
		</tr>
		<tr>
			<td>\s</td>
			<td>Любой символ пробела, табуляции или новой строки.</td>
		</tr>
		<tr>
			<td>\S</td>
			<td>Любой символ, кроме пробела, табуляции или новой строки.</td>
		</tr>
		<tr>
			<td>\d</td>
			<td>Любая цифра. Эквивалентно [0-9]</td>
		</tr>
		<tr>
			<td>\D</td>
			<td>Любой символ, кроме цифр. Эквивалентно [^0-9]</td>
		</tr>
		<tr>
			<td>\w</td>
			<td>Любая буква, цифра, или _.</td>
		</tr>
		<tr>
			<td>\W</td>
			<td>Любой символ, кроме букв, цифр, и _.</td>
		</tr>
		<tr>
			<td>\b</td>
			<td>Символ между символом, совпадающим с \w, и символом, не совпадающим с \w в любом порядке.</td>
		</tr>
		<tr>
			<td>\B</td>
			<td>Символ между двумя символами, совпадающими с \w или \W.</td>
		</tr>
		<tr>
			<td>\A</td>
			<td>Начало всего текста</td>
		</tr>
		<tr>
			<td>\Z</td>
			<td>Конец всего текста</td>
		</tr>
		<tr>
			<td>^</td>
			<td>Начало всего текста или начало строчки текста, если flag=re.MULTILINE</td>
		</tr>
		<tr>
			<td>$</td>
			<td>Конец всего текста или конец строчки текста, если flag=re.MULTILINE</td>
		</tr>
		<tr>
			<td>\r</td>
			<td>carriage return или CR, символ Юникода U+2185.</td>
		</tr>
		<tr>
			<td>\t</td>
			<td>Tab символ</td>
		</tr>
		<tr>
			<td>\0</td>
			<td>null, символ Юникода U+2400.</td>
		</tr>
		<tr>
			<td>\v</td>
			<td>Вертикальный пробел в Юникоде</td>
		</tr>
		<tr>
			<td>\xYY</td>
			<td>8-битный символ с заданным шестнадцатеричным значением. [Таблица юникода](https://unicode-table.com/en/). Например \x2A находит символ *.</td>
		</tr>
		<tr>
			<td>\ddd</td>
			<td>8-битный символ с заданным восьмеричным значением. [Таблица UTF-8](https://www.utf8-chartable.de/unicode-utf8-table.pl?utf8=oct)</td>
		</tr>
		<tr>
			<td>[\b]</td>
			<td>Символ backspace или BS. В скобках, т.к. \b уже занято другим спецсимволом.</td>
		</tr>
		<tr>
			<td>\f</td>
			<td>Символ разрыва страницы.</td>
		</tr>
	</tbody>
</table>